{"version":3,"file":"com.wsscode.oge.ui.flame_graph.js","sources":["com/wsscode/oge/ui/flame_graph.cljs"],"mappings":"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","names":["var_args","args__4502__auto__","len__4499__auto__","i__4500__auto__","argseq__4503__auto__","cljs.core/IndexedSeq","com.wsscode.oge.ui.flame-graph/js-call","seq30637","G__30638","cljs.core/first","cljs.core/next","G__30639","self__4486__auto__","obj","fn","args","f","goog.object/get","cljs.core/to-array","js/console.log","js/module$node_modules$d3_flame_graph$dist$d3_flamegraph","com.wsscode.oge.ui.flame-graph/render-flame","profile","target","profile'","com.wsscode.pathom.profile/profile->flame-graph","cljs.core/clj->js","tooltip","d","name","G__30645","G__30646","goog.object/getValueByKeys","value","children","self","cljs.core.transduce.cljs$core$IFn$_invoke$arity$3","p1__30643#","cljs.core.map.cljs$core$IFn$_invoke$arity$1","cljs.core/+","total-value","pct","tip","js/module$node_modules$d3_tip$index","com.wsscode.oge.ui.flame_graph.js_call.cljs$core$IFn$_invoke$arity$variadic","flame","js/module$node_modules$d3_flame_graph$dist$d3_flamegraph.flamegraph","js/d3.select","this__28659__auto__","js/React.Component","goog.object/clone","js/React.Component.prototype","x30652","next-props__28515__auto__","next-state__28516__auto__","this__28514__auto__","cljs.core/PROTOCOL_SENTINEL","ident__28523__auto__","fulcro.client.primitives/ident","fulcro.client.primitives/props","next-ident__28524__auto__","fulcro.client.primitives/-next-props","cljs.core.not_EQ_.cljs$core$IFn$_invoke$arity$2","idxr__28525__auto__","cljs.core.get_in.cljs$core$IFn$_invoke$arity$2","fulcro.client.primitives/get-reconciler","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$2","indexes__28526__auto__","cljs.core.update_in.cljs$core$IFn$_invoke$arity$4","cljs.core/disj","cljs.core.fnil.cljs$core$IFn$_invoke$arity$2","cljs.core/conj","fulcro.client.primitives/merge-pending-props!","fulcro.client.primitives/merge-pending-state!","fulcro.client.primitives/*blindly-render*","next-children__28517__auto__","G__30658","fulcro.client.primitives/FulcroProps","fulcro.client.primitives/unwrap","current-props__28518__auto__","next-props-stale?__28519__auto__","fulcro.client.primitives/get-basis-time","props-changed?__28520__auto__","state-changed?__28521__auto__","and__3911__auto__","G__30659","G__30660","children-changed?__28522__auto__","or__3922__auto__","r__28530__auto__","cfg__28531__auto__","st__28532__auto__","indexer__28529__auto__","goog.object/set","cljs.core/deref","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$variadic","cljs.core/update-in","cljs.core/dissoc","fulcro.client.impl.protocols/drop-component!","prev-props__28527__auto__","prev-state__28528__auto__","fulcro.client.primitives/clear-prev-props!","fulcro.client.impl.protocols/index-component!","this__28504__auto__","reconciler__28505__auto__","lifecycle__28506__auto__","G__30664","G__30665","next-props__28489__auto__","this__28488__auto__","map__30672","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","this__28513__auto__","*reconciler*30674","fulcro.client.primitives/*reconciler*","*depth*30675","fulcro.client.primitives/*depth*","*shared*30676","fulcro.client.primitives/*shared*","*instrument*30677","fulcro.client.primitives/*instrument*","*parent*30678","fulcro.client.primitives/*parent*","fulcro.client.primitives/depth","fulcro.client.primitives.shared.cljs$core$IFn$_invoke$arity$1","fulcro.client.primitives/instrument","x30697","x30698","this__28662__auto__","writer__28663__auto__","opt__28664__auto__","cljs.core/-write","com.wsscode.oge.ui.flame-graph/FlameGraph","this","map__30670","fulcro.client.dom/macro-create-element*","p1__30648#","com.wsscode.oge.ui.flame-graph/flame-graph","fulcro.client.primitives.factory.cljs$core$IFn$_invoke$arity$1"],"sourcesContent":["(ns com.wsscode.oge.ui.flame-graph\n  (:require [fulcro.client.primitives :as om]\n            [fulcro.client.dom :as dom]\n            [com.wsscode.pathom.profile :as p.profile]\n            [cljsjs.d3]\n            [\"d3-tip\" :as tip]\n            [\"d3-flame-graph\" :as flame]\n            [goog.object :as gobj]))\n\n(defn js-call [obj fn & args]\n  (let [f (gobj/get obj fn)]\n    (.apply f obj (to-array args))))\n\n(js/console.log \"FLAME\" flame)\n\n(defn render-flame [profile target]\n  (let [profile' (-> profile p.profile/profile->flame-graph clj->js)\n        tooltip  (fn [d]\n                   (let [name        (gobj/getValueByKeys d #js [\"data\" \"name\"])\n                         value       (gobj/get d \"value\")\n                         children    (gobj/get d \"children\")\n                         self        (->> (transduce (map #(gobj/get % \"value\")) + children)\n                                          (- value))\n                         total-value (gobj/get profile' \"value\")\n                         pct         (-> (/ value total-value) (* 100) (.toFixed 2))]\n                     (str name \"<br>\"\n                       self \"/\" value \"ms<br />\"\n                       pct \"% of total\")))\n        tip      (-> (tip)\n                     (js-call \"attr\" \"class\" \"d3-flame-graph-tip\")\n                     (js-call \"html\" tooltip))\n\n        flame    (-> (flame/flamegraph)\n                     (js-call \"width\" 600)\n                     (js-call \"height\" 300)\n                     (js-call \"tooltip\" tip))]\n\n    (-> (js/d3.select target)\n        (.datum profile')\n        (.call flame))))\n\n(om/defui ^:once FlameGraph\n  Object\n  (componentDidMount [this]\n    (let [{:keys [profile]} (om/props this)]\n      (render-flame profile (gobj/get this \"root\"))))\n\n  (componentWillReceiveProps [this {:keys [profile]}]\n    (when (not= profile (-> this om/props :profile))\n      (render-flame profile (gobj/get this \"root\"))))\n\n  (render [this]\n    (dom/div #js {:ref #(gobj/set this \"root\" %)})))\n\n(def flame-graph (om/factory FlameGraph))\n"]}